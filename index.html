<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Hua Qing | Gongbi Art</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="bg-stone-50 text-stone-800">

<!-- ================= NAV ================= -->
<nav class="fixed top-0 w-full bg-white/90 backdrop-blur z-50 border-b">
  <div class="max-w-7xl mx-auto flex justify-between items-center px-6 h-16">
    <h1 class="font-bold tracking-widest">HUA QING</h1>
    <div class="flex gap-4 items-center">
      <button id="authBtn" class="text-sm">Sign In</button>
      <button id="adminBtn" class="hidden text-sm text-red-700">Admin</button>
    </div>
  </div>
</nav>

<div class="h-16"></div>

<!-- ================= HERO ================= -->
<section class="h-screen flex items-center justify-center bg-stone-100">
  <h2 class="text-4xl italic">Timeless Serenity, Painted in Silk</h2>
</section>

<!-- ================= ABOUT / VIDEO ================= -->
<section class="py-24 bg-white">
  <div class="max-w-6xl mx-auto grid md:grid-cols-2 gap-12 items-center px-6">
    <div class="shadow-lg aspect-video">
      <iframe
        class="w-full h-full"
        src="https://www.youtube.com/embed/zN0VzZRzlqM?autoplay=1&mute=1&loop=1&playlist=zN0VzZRzlqM&controls=0&modestbranding=1&playsinline=1"
        allow="autoplay; encrypted-media; picture-in-picture"
        allowfullscreen>
      </iframe>
    </div>
    <div>
      <h3 class="text-3xl italic mb-6">The Craft</h3>
      <p class="leading-loose">
        Gongbi is a meditation of patience and precision.
        Each stroke carries silence and time.
      </p>
    </div>
  </div>
</section>

<!-- ================= GALLERY ================= -->
<section class="py-24 bg-stone-100">
  <div class="max-w-7xl mx-auto px-6">
    <h3 class="text-4xl italic text-center mb-12">Gallery</h3>
    <div id="gallery" class="columns-1 md:columns-3 gap-6"></div>
  </div>
</section>

<!-- ================= AUTH MODAL ================= -->
<div id="authModal" class="fixed inset-0 bg-black/70 hidden flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded w-80 space-y-4">
    <h4 class="text-xl font-bold text-center">Account</h4>

    <input id="regEmail" placeholder="Email" class="border p-2 w-full">
    <input id="regPassword" placeholder="Password" type="password" class="border p-2 w-full">
    <input id="regName" placeholder="Nickname" class="border p-2 w-full">

    <button id="registerBtn" class="w-full bg-stone-800 text-white py-2">Register</button>
    <button id="loginBtn" class="w-full border py-2">Login</button>
    <button onclick="closeAuth()" class="w-full text-xs text-stone-400">Close</button>
  </div>
</div>

<!-- ================= ADMIN UPLOAD ================= -->
<button id="addArtworkBtn"
  class="hidden fixed bottom-6 right-6 bg-red-700 text-white w-14 h-14 rounded-full text-3xl">+</button>

<input type="file" id="fileInput" multiple hidden>

<!-- ================= FIREBASE ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, updateProfile, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyBDvZ7oykdugl6DQH_p-0KOgy0sfMuMmFc",
  authDomain: "qinghua-852c1.firebaseapp.com",
  projectId: "qinghua-852c1",
  storageBucket: "qinghua-852c1.appspot.com",
  appId: "1:391709518256:web:a18730b2d099c362e9ce75"
};

const ADMIN_EMAILS = ["elin641@163.com"];

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

/* ===== AUTH ===== */
const authModal = document.getElementById("authModal");
authBtn.onclick = () => authModal.classList.remove("hidden");
function closeAuth(){ authModal.classList.add("hidden"); }

registerBtn.onclick = async () => {
  const email = regEmail.value;
  const pass = regPassword.value;
  const name = regName.value;
  const cred = await createUserWithEmailAndPassword(auth, email, pass);
  await updateProfile(cred.user, { displayName: name });
  await sendEmailVerification(cred.user);
  alert("Check your email to verify.");
};

loginBtn.onclick = async () => {
  await signInWithEmailAndPassword(auth, regEmail.value, regPassword.value);
};

onAuthStateChanged(auth, user => {
  authModal.classList.add("hidden");
  authBtn.textContent = user ? user.displayName : "Sign In";

  if (user && ADMIN_EMAILS.includes(user.email)) {
    adminBtn.classList.remove("hidden");
    addArtworkBtn.classList.remove("hidden");
  }
});

/* ===== GALLERY ===== */
const gallery = document.getElementById("gallery");
onSnapshot(collection(db, "artworks"), snap => {
  gallery.innerHTML = "";
  snap.forEach(d => {
    const img = document.createElement("img");
    img.src = d.data().img;
    img.className = "mb-6 rounded shadow";
    gallery.appendChild(img);
  });
});

/* ===== ADMIN UPLOAD ===== */
addArtworkBtn.onclick = () => fileInput.click();
fileInput.onchange = async () => {
  for (let file of fileInput.files) {
    const r = ref(storage, "artworks/" + Date.now() + file.name);
    await uploadBytes(r, file);
    const url = await getDownloadURL(r);
    await addDoc(collection(db, "artworks"), {
      img: url,
      createdAt: serverTimestamp()
    });
  }
};
</script>

</body>
</html>
